import numpy as np
import matplotlib.pyplot as plt
from tabulate import tabulate

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False


# 生成幅值比数据：0.01-5用0.05步长，5以上增大步长
ratios = np.concatenate((
    np.arange(0.01, 5.01, 0.05),    # 0.01-5 步长0.05
    np.arange(5.5, 10.1, 0.5),      # 5.5-10 步长0.5
    np.arange(11, 21, 1),           # 11-20 步长1
    np.arange(25, 101, 5)           # 25-100 步长5
))

# 计算对应的dB值
dbs = 20 * np.log10(ratios)

# 创建关系表 (低频区域全显示，其他区域抽样显示)
table_data = []
for ratio, db in zip(ratios, dbs):
    # 低频区域(0.9-1.1)全显示，其他区域每5个点显示一个
    if (0.9 <= ratio <= 1.1) or (np.where(ratios == ratio)[0][0] % 5 == 0):
        table_data.append([ratio, f"{db:.4f} dB"])

# 打印表格
print("幅值比与dB对应关系表：")
print(tabulate(table_data, headers=["幅值比", "dB值"], tablefmt="grid"))

# 绘制伯德图关系曲线
plt.figure(figsize=(12, 6))

# 半对数坐标图 (标准伯德图)
plt.subplot(121)
plt.semilogx(ratios, dbs, 'b-', linewidth=1.5)
plt.title('幅值比-dB关系 (半对数坐标)')
plt.xlabel('幅值比 (对数刻度)')
plt.ylabel('dB值')
plt.grid(True, which="both", ls="--")

# 线性坐标图
plt.subplot(122)
plt.plot(ratios, dbs, 'r-', linewidth=1.5)
plt.title('幅值比-dB关系 (线性坐标)')
plt.xlabel('幅值比')
plt.ylabel('dB值')
plt.grid(True)

plt.tight_layout()
plt.show()


# 幅值比与dB对应关系表：
# +----------+-------------+
# |   幅值比 | dB值        |
# +==========+=============+
# |     0.01 | -40.0000 dB |
# +----------+-------------+
# |     0.26 | -11.7005 dB |
# +----------+-------------+
# |     0.51 | -5.8486 dB  |
# +----------+-------------+
# |     0.76 | -2.3837 dB  |
# +----------+-------------+
# |     0.91 | -0.8192 dB  |
# +----------+-------------+
# |     0.96 | -0.3546 dB  |
# +----------+-------------+
# |     1.01 | 0.0864 dB   |
# +----------+-------------+
# |     1.06 | 0.5061 dB   |
# +----------+-------------+
# |     1.26 | 2.0074 dB   |
# +----------+-------------+
# |     1.51 | 3.5795 dB   |
# +----------+-------------+
# |     1.76 | 4.9103 dB   |
# +----------+-------------+
# |     2.01 | 6.0639 dB   |
# +----------+-------------+
# |     2.26 | 7.0822 dB   |
# +----------+-------------+
# |     2.51 | 7.9935 dB   |
# +----------+-------------+
# |     2.76 | 8.8182 dB   |
# +----------+-------------+
# |     3.01 | 9.5713 dB   |
# +----------+-------------+
# |     3.26 | 10.2644 dB  |
# +----------+-------------+
# |     3.51 | 10.9061 dB  |
# +----------+-------------+
# |     3.76 | 11.5038 dB  |
# +----------+-------------+
# |     4.01 | 12.0629 dB  |
# +----------+-------------+
# |     4.26 | 12.5882 dB  |
# +----------+-------------+
# |     4.51 | 13.0835 dB  |
# +----------+-------------+
# |     4.76 | 13.5521 dB  |
# +----------+-------------+
# |     5.5  | 14.8073 dB  |
# +----------+-------------+
# |     8    | 18.0618 dB  |
# +----------+-------------+
# |    11    | 20.8279 dB  |
# +----------+-------------+
# |    16    | 24.0824 dB  |
# +----------+-------------+
# |    25    | 27.9588 dB  |
# +----------+-------------+
# |    50    | 33.9794 dB  |
# +----------+-------------+
# |    75    | 37.5012 dB  |
# +----------+-------------+
# |   100    | 40.0000 dB  |
# +----------+-------------+
